"use strict";function extendObject(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function distanceTo(a,b){var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y);return Math.sqrt(c*c+d*d)}function getRandom(a,b){return~~(Math.random()*(b-a+1)+a)}function scrollX(){return window.pageXOffset||window.document.documentElement.scrollLeft}function scrollY(){return window.pageYOffset||window.document.documentElement.scrollTop}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),function(a){function b(){this.data={steps:[{text:"cola zero",shape:{src:"bottle.png",radius:{max:5,min:0}},density:4,fontSize:100,drawing:!1},{text:"no sugar",shape:{src:"sugar.png",radius:{max:6,min:2}},density:4,fontSize:90,drawing:!1},{text:"just a bubbles",shape:{src:"hearts.png",radius:{max:5,min:2}},density:3,fontSize:90,drawing:!1},{text:"",video:"ozVQ4IJd2Po",drawing:!1},{text:"Draw a path",textSmall:"win a price",shape:{src:"maze.png",radius:{max:4,min:3}},density:6,fontSize:100,blocked:!0,drawing:!0},{text:"Like us!",url:"https://www.facebook.com/cocacolazero",shape:{src:"like.png",radius:{max:7,min:2}},density:4,fontSize:80,drawing:!1}]}}b.prototype.getData=function(){return this.data},a.app.Model=b}(window),function(a){function b(){this.step=0}b.prototype={canvasExtension:{mouse:{x:-99999,y:-99999},particles:{shape:[],text:[],path:[],all:[]},shape:{},swapText:[],colors:["#fff","#e13123"],_init:function(a,b){return this.storage=a,this.data=this.storage.steps[b],this.step=b,this.canvasContainer=document.querySelector("#canvas-stage"),this.canvas=document.createElement("canvas"),this.canvas.width=this.canvasContainer.offsetWidth,this.canvas.height=this.canvasContainer.offsetHeight,this.canvasContainer.appendChild(this.canvas),this.canvas.getContext&&this.canvas.getContext("2d")?(this.context=this.canvas.getContext("2d"),this._createParticles(),document.body.style.cursor="pointer",this._initEvents(),this.canvas):void 0},_goTo:function(a){this.step=a+1,this.data=this.storage.steps[this.step],this._refresh()},_getIndex:function(){return this.step},_onMouseMove:function(a){a.preventDefault(),this.mouse.x=a.pageX-(scrollX()+this.canvas.getBoundingClientRect().left),this.mouse.y=a.pageY-(scrollY()+this.canvas.getBoundingClientRect().top),this.data.drawing&&this._drawPath()},_onWindowResize:function(){this.canvas.width=this.canvasContainer.offsetWidth,this.particles.all=[],this._createShapeParticles(),this._createTextParticles()},_initEvents:function(){var b=this;a.onresize=this._onWindowResize.bind(this),this.canvas.addEventListener("mousemove",function(a){b._onMouseMove.call(b,a)},!1)},_createParticles:function(){this._createShapeParticles(),this._createTextParticles(),this._renderLoop()},_refresh:function(){this.particles={shape:[],text:[],path:[],all:[]},this._clear(),this._createShapeParticles(),this._createTextParticles()},_drawPath:function(){this.pathStarted&&this.pathFinished&&(this.pathStarted=this.pathFinished=!1,this._goTo(4)),this.mouse.x>this.imgX+110&&this.mouse.x<this.imgX+130&&this.mouse.y>this.imgY&&this.mouse.y<this.imgY+20&&(this.pathStarted=!0),this.mouse.x>this.imgX2-110&&this.mouse.x<this.imgX2-90&&this.mouse.y>this.imgY2-40&&this.mouse.y<this.imgY2-20&&(this.pathFinished=!0),this.mouse.x>this.imgX&&this.mouse.x<this.imgX2&&this.mouse.y>this.imgY&&this.mouse.y<this.imgY2&&this.pathStarted&&this.particles.path.push({x:this.mouse.x,y:this.mouse.y,x1:this.mouse.x,y1:this.mouse.y,hasBorn:!0,ease:1,bornSpeed:0,alpha:1,maxAlpha:1,radius:2,maxRadius:2,color:"#fff",interactive:!1})},_generateText:function(){this.context.font=this.data.fontSize+"px Arial, sans-serif",this.context.fillStyle="rgb(255, 255, 255)",this.context.textAlign="center";var a=this.data.text.toUpperCase();this.context.fillText(a,.5*this.canvas.width,this.canvas.height-70),this.data.textSmall&&(this.context.font=this.data.fontSize-25+"px Arial, sans-serif",this.context.fillText(this.data.textSmall.toUpperCase(),.5*this.canvas.width,this.canvas.height-10))},_grabParticlesFromCanvas:function(){for(var a=[],b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=0;c<b.width;c+=this.data.density)for(var d=0;d<b.height;d+=this.data.density){var e=b.data[4*d*b.width+4*c-1];if(255===e){var f=getRandom(this.data.shape.radius.min,30),g=f>0||12>f?!1:!0,e=this.colors[~~(Math.random()*this.colors.length)];a.push({x:getRandom(-this.canvas.width,2*this.canvas.width),y:getRandom(0,500),x1:c,y1:d,hasBorn:g,ease:.04+.06*Math.random(),bornSpeed:.07+.07*Math.random(),alpha:0,maxAlpha:.4+.4*Math.random(),radius:f,maxRadius:this.data.shape.radius.max||8,orbit:8,angle:.1,color:e,interactive:!1})}}return a},_createShapeParticles:function(){var a=this;a.img=new Image,a.img.onload=function(){a.imgX=a.canvas.width/2-a.img.width/2,a.imgX2=a.imgX+a.img.width,a.imgY=30,a.imgY2=a.imgY+a.img.height,a.context.drawImage(a.img,a.imgX,30),a.particles.shape=a._grabParticlesFromCanvas(),a._clear()},a.img.src=this.data.shape.src},_createTextParticles:function(){this._generateText(),this.particles.text=this._grabParticlesFromCanvas()},_clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},_updateTransition:function(){var a=this;a.data.drawing?[].forEach.call(this.particles.all,function(a){a.x=a.x1,a.y=a.y1,a.angle+=getRandom(1,8)/100}):[].forEach.call(this.particles.all,function(b){b.interactive?(b.x+=.08*(a.mouse.x+60*Math.sin(b.angle)-b.x),b.y+=.08*(a.mouse.y+60*Math.sin(b.angle)-b.y)):(b.x+=.08*(b.x1+2*Math.sin(b.angle)-b.x),b.y+=.08*(b.y1+2*Math.sin(b.angle)-b.y)),b.angle+=getRandom(1,8)/100})},_update:function(){var a=this;this._updateTransition(),this.particles.all=this.particles.shape.concat(this.particles.text,this.particles.path),[].forEach.call(this.particles.all,function(a){a.alpha+=.05*(a.maxAlpha-a.alpha),a.hasBorn?(a.radius+=(0-a.radius)*a.bornSpeed,0===Math.round(a.radius)&&(a.hasBorn=!1)):(a.radius+=(a.maxRadius-a.radius)*a.bornSpeed,Math.round(a.radius)===a.maxRadius&&(a.hasBorn=!0))}),[].forEach.call(this.particles.shape,function(b){distanceTo(a.mouse,b)<=5&&1==a.data.drawing?(a.pathStarted&&(a.particles.path=[],a._createShapeParticles()),a.pathStarted=a.pathFinished=!1):b.interactive=distanceTo(a.mouse,b)<=b.radius+60?!0:!1})},_render:function(){var a=this.context;[].forEach.call(this.particles.all,function(b){a.save(),a.globalAlpha=b.alpha,a.fillStyle=b.color,a.beginPath(),a.arc(b.x,b.y,b.radius,0,2*Math.PI),a.fill(),a.restore()})},_renderLoop:function(){this._clear(),this._update(),this._render(),requestAnimFrame(this._renderLoop.bind(this))}}},a.app.View=b}(window),function(a){function b(a,b,c){this.view=a,this.model=b,this.defaultsSwap=new this._defaults,this.options=extendObject(this.defaultsSwap,c),this.stepIndex=0}b.prototype={_defaults:function(){return{value:{}}},_init:function(){this._initEvents()},_initEvents:function(){var a=this;[].forEach.call(document.body.querySelectorAll('[data-toggle="demo"]'),function(b){b.addEventListener("click",function(){a._startDemo()})})},_toggleYouTubePlayer:function(){document.querySelector("#canvas-stage").style.display="block",document.querySelector("#player").style.display="none"},_initYouTubePlayer:function(){function b(a){a.target.playVideo()}function c(a){0===a.data&&(e.view.canvasExtension._goTo(e.stepIndex+1),e.stepIndex=e.view.canvasExtension._getIndex(),e._toggleYouTubePlayer())}var d,e=this,f=document.createElement("script"),g=document.getElementsByTagName("script")[0];f.src="https://www.youtube.com/iframe_api",g.parentNode.insertBefore(f,g),document.querySelector("#canvas-stage").style.display="none",a.onYouTubeIframeAPIReady=function(){d=new YT.Player("player",{height:e.canvas.height,width:e.canvas.width,videoId:e.data.steps[e.stepIndex+1].video,events:{onReady:b,onStateChange:c}})}},_startDemo:function(){var a=this;document.querySelector("#modal").className="in",document.querySelector("#overlay").className="in",this.data=this.model.getData(),this.canvas=this.view.canvasExtension._init(this.data,0),this.canvas.addEventListener("click",function(b){a._onCanvasClick.call(a,b)},!1)},_onCanvasClick:function(b){b.preventDefault(),this.stepIndex=this.view.canvasExtension._getIndex(),this.data.steps[this.stepIndex].url?a.open(this.data.steps[this.stepIndex].url):this.data.steps[this.stepIndex+1].video?this._initYouTubePlayer():this.data.steps[this.stepIndex].blocked||this.view.canvasExtension._goTo(this.stepIndex)}},a.app.Controller=b}(window),function(){function a(){this.model=new app.Model,this.view=new app.View,this.controller=new app.Controller(this.view,this.model),this.controller._init()}new a}();